# Module DNS

Ease the usage of local domain names for the tests. It deploys a simple CoreDNS instance that resolve the given domain to 127.0.0.1. By default, the domain is `sandbox.local`.

It is required to edit your `/etc/resolv.conf` file and add `nameserver 127.0.0.1` on top of the other ones.

## Usage

Deploy the example for `modules/dns/examples/simple`. Then open a browser and go to http://nginx.sandbox.local. The url will be resolve automatically to your localhost. Therefore, any ingress or gateway set up for the domain will be resolve as well.

## Configure DNS

### NetworkManager

If your distro is using NetworkManager.

Disable generation of /etc/resolv.conf

```bash
sudo cat > /etc/NetworkManager/conf.d/90-dns-none.conf << EOF
[main]
dns=none
EOF

sudo systemctl reload NetworkManager
```

Then edit /etc/resolv.conf and add `nameserver 127.0.0.1` on top of the others. Per example:

```
# Generated by NetworkManager
search lan
nameserver 127.0.0.1 # <-- HERE
nameserver 192.168.1.254
nameserver 2001:861:4501:2e0:f605:95ff:fe1f:382c
```

Once you deployed the local-dns unit, you can test the dns resolution with the following command:

```bash
dig a example.sandbox.local
```

Which will give you the output:

```
; <<>> DiG 9.20.8 <<>> a example.sandbox.local
;; global options: +cmd
;; Got answer:
;; WARNING: .local is reserved for Multicast DNS
;; You are currently testing what happens when an mDNS query is leaked to DNS
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 23642
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: a1d5ee41d17eb2fe (echoed)
;; QUESTION SECTION:
;example.sandbox.local.         IN      A

;; ANSWER SECTION:
example.sandbox.local.  0       IN      A       127.0.0.1

;; Query time: 0 msec
;; SERVER: 127.0.0.1#53(127.0.0.1) (UDP)
;; WHEN: Tue May 13 06:36:13 CEST 2025
;; MSG SIZE  rcvd: 99
```

The important part is the ANSWER Section, if not present, something went wrong.
